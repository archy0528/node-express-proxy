(this["webpackJsonpempf-login"]=this["webpackJsonpempf-login"]||[]).push([[0],{331:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(11),c=n.n(i),s=n(63),o=n(156),l=n(375),u=n(376),j=n(85),d=n(377),b=n(31),O=n(37),h=n(42),f=n(21),p=n(7),g=Object(O.d)({}).getInitialState({token:null,user:null,isLoading:!1,error:null}),x=n(117),m=n.n(x),v=n(157),y=n(12),k=n(13),C=n(23),w=n(24),S=n(158),P=n.n(S),T=function(){function e(t){Object(y.a)(this,e),this.instance=P.a.create(t),this.instance.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)})),this.instance.interceptors.response.use((function(e){var t,n,r=null===(t=e.data)||void 0===t?void 0:t.errorCode,a=null===(n=e.data)||void 0===n?void 0:n.errorMessage;return r>=400?Promise.reject(a):e.data}),(function(e){if(e.response){var t,n,r=null===(t=e.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.errorMessage;if(r)return Promise.reject(r)}else{if(!e.request)return Promise.reject(e.message);if("ECONNABORTED"===e.code)return Promise.reject("Couldn't search at this moment. Please try again later.")}return Promise.reject("Couldn't search at this moment. Please try again later.")}))}return Object(k.a)(e,[{key:"get",value:function(e,t){return this.instance.get(e,t)}},{key:"post",value:function(e,t,n){return this.instance.post(e,t,n)}},{key:"put",value:function(e,t,n){return this.instance.put(e,t,n)}},{key:"delete",value:function(e,t,n){return this.instance.delete(e,t,n)}}]),e}(),F=n(88),L=new(function(e){Object(C.a)(n,e);var t=Object(w.a)(n);function n(){return Object(y.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"login",value:function(e){var t=Object(F.pick)(e,["username","password"]);return this.instance.post("/ad/api/auth/login",t)}},{key:"getByToken",value:function(e){return this.instance.get("/ad/api/auth/userinfo",{headers:{Authorization:"Bearer ".concat(e)}})}}]),n}(T))({baseURL:""}),B=Object(O.c)("@@EMPF/USER/LOGIN",function(){var e=Object(v.a)(m.a.mark((function e(t,n){var r,a,i,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.rejectWithValue,e.prev=1,e.next=4,L.login(t);case 4:return a=e.sent,i=a.sessionToken,e.next=8,L.getByToken(i);case 8:return c=e.sent,e.abrupt("return",{token:i,user:c});case 12:return e.prev=12,e.t0=e.catch(1),e.abrupt("return",r({error:e.t0}));case 15:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t,n){return e.apply(this,arguments)}}()),I=Object(O.b)("@@EMPF/USER/LOGOUT",(function(){return{payload:{}}})),N=n(159),z={key:"user",storage:n.n(N).a,blacklist:["isLoading","error"]},E=Object(O.e)(g,(function(e){return e.addCase(B.pending,(function(e,t){return Object(p.a)(Object(p.a)({},e),{},{isLoading:!0,error:null})})).addCase(B.fulfilled,(function(e,t){var n=t.payload,r=n.token,a=n.user;return Object(p.a)(Object(p.a)({},e),{},{isLoading:!1,error:null,token:r,user:a})})).addCase(B.rejected,(function(e,t){var n=t.payload.error;return Object(p.a)(Object(p.a)({},e),{},{isLoading:!1,error:n})})).addCase(I,(function(e,t){return Object(p.a)(Object(p.a)({},e),{},{token:null,user:null})}))})),M=Object(h.g)(z,E),R=Object(f.c)({user:M});var A=n(77),H=n(160),W=n(161),U=[{code:"en-US",lang:"English"},{code:"zh-CN",lang:"Chinese (Simplified)"},{code:"zh-HK",lang:"Chinese (Traditional)"}];A.a.use(H.a),A.a.use(W.a),A.a.init({debug:!1,fallbackLng:"en-US",whitelist:Object(F.map)(U,"code"),backend:{loadPath:"".concat("/ad","/locales/i18n/{{lng}}/{{ns}}.json")}});var D=A.a,q=n(175),G=Object(q.a)({palette:{primary:{main:"#0D6A88"}},mixins:{toolbar:{minHeight:51}},typography:{fontFamily:["Roboto","Helvetica","Arial","sans-serif"].join(",")}});G.overrides={MuiButton:{contained:{borderRadius:40}}},G.props={MuiAppBar:{position:"fixed",elevation:0},MuiToolbar:{variant:"dense"},MuiTextField:{margin:"none",variant:"outlined",size:"small",fullWidth:!0},MuiButton:{variant:"contained",color:"primary"}};var K=G,J=n(17),V=n(40),Q=n(47),X=n(4),Y=Object(r.createContext)(),Z=Y.Provider,$=function(e,t){switch(t.type){case"settingsToggled":return Object(p.a)(Object(p.a)({},e),{},{settingsOpen:!e.settingsOpen});default:return e}},_=function(e){var t=e.children,n=Object(r.useReducer)($,{settingsOpen:!1}),a=Object(Q.a)(n,2),i=a[0],c=a[1],s=Object(r.useCallback)((function(){return c({type:"settingsToggled"})}),[c]);return Object(X.jsx)(Z,{value:Object(p.a)(Object(p.a)({},i),{},{settingsToggled:s}),children:t})},ee=function(){return Object(r.useContext)(Y)},te=n(365),ne=n(383),re=n(366),ae=n(367),ie=n(368),ce=n(369),se=n(177),oe=function(e){return Object(X.jsx)(se.a,Object(p.a)(Object(p.a)({},e),{},{children:Object(X.jsxs)("g",{transform:"translate(-1249.5 -17)",children:[Object(X.jsx)("rect",{width:23,height:23,rx:4,transform:"translate(1249.5 17)",fill:"#fff"}),Object(X.jsx)("text",{transform:"translate(1252.5 35)",fill:"#02a0cf",fontSize:17,fontFamily:"PingFangHK-Semibold,PingFang HK",fontWeight:600,children:Object(X.jsx)("tspan",{x:0,y:0,children:"\u4e2d"})})]})}))},le=Object(te.a)((function(e){return{appBar:{zIndex:e.zIndex.drawer+1},title:{fontStyle:"italic",fontWeight:e.typography.fontWeightBold,margin:e.spacing(0,1,0,2)},subtitle:{flexGrow:1}}})),ue=function(){var e=le(),t=ee().settingsToggled,n=Object(ne.a)(["header"]).t;return Object(X.jsx)(re.a,{className:e.appBar,children:Object(X.jsxs)(ae.a,{children:[Object(X.jsx)(ie.a,{className:e.title,variant:"h6",children:n("header:title")}),Object(X.jsx)(ie.a,{className:e.subtitle,variant:"body1",children:n("header:subtitle")}),Object(X.jsx)(ce.a,{onClick:t,children:Object(X.jsx)(oe,{fontSize:"small"})})]})})},je=n(379),de=n(382),be=Object(te.a)((function(e){return{paper:{width:240,border:0,boxShadow:"0px 2px 10px #BFBEBE96"},container:{overflow:"auto"}}})),Oe=function(e){var t=e.children,n=Object(V.a)(e,["children"]),r=be();return Object(X.jsx)(de.a,Object(p.a)(Object(p.a)({classes:{paper:r.paper}},n),{},{children:Object(X.jsx)("div",{className:r.container,children:t})}))},he=n(46),fe=n(171),pe=n.n(fe),ge=n(84),xe=function(e){return e.user},me=Object(ge.a)(xe,(function(e){return e.user})),ve=Object(ge.a)(xe,(function(e){return e.isLoading})),ye=Object(ge.a)(xe,(function(e){return e.error})),ke=function(e){return Object(s.b)((function(e){return{user:me(e)}}))((function(t){var n=t.user,a=Object(V.a)(t,["user"]),i=Object(J.f)().pathname;return Object(r.useEffect)((function(){n&&"/ad/sec"!==i&&(window.location.href="/ad/sec")}),[n,i]),n?null:Object(X.jsx)(e,Object(p.a)({},a))}))},Ce=function(e){return function(t){var n=Object(he.useField)(t),r=Object(Q.a)(n,3),a=r[0],i=r[1],c=r[2],s=i.touched,o=i.error;return Object(X.jsx)(e,Object(p.a)(Object(p.a)({error:s&&o&&!0,helperText:s&&o,helpers:c},a),t))}},we=n(378),Se=Ce((function(e){e.helpers;var t=Object(V.a)(e,["helpers"]);return Object(X.jsx)(we.a,Object(p.a)({},t))})),Pe=n(370),Te=function(e){var t=Object(he.useFormikContext)().handleSubmit;return Object(X.jsx)(Pe.a,Object(p.a)({type:"submit",onClick:t},e))},Fe=function(e){var t=e.children,n=Object(V.a)(e,["children"]),r=Object(he.useFormikContext)(),a=r.handleSubmit,i=r.handleReset;return Object(X.jsxs)("form",Object(p.a)(Object(p.a)({onSubmit:a,onReset:i,autoComplete:"off"},n),{},{children:[t,Object(X.jsx)(pe.a,{offset:0,align:"middle",focusDelay:200,ease:"linear",duration:200})]}))};Fe.Input=Se,Fe.Submit=Te;var Le=Fe,Be=n(384),Ie=function(){var e=Object(ne.a)("translation").i18n;return Object(X.jsx)(we.a,{select:!0,label:"Language",variant:"outlined",size:"small",fullWidth:!0,value:e.language,onChange:function(t){e.changeLanguage(t.target.value)},children:U.map((function(e){return Object(X.jsx)(Be.a,{value:e.code,children:e.lang},e.code)}))})},Ne=function(){var e=ee(),t=e.settingsOpen,n=e.settingsToggled;return Object(X.jsx)(Oe,{variant:"temporary",anchor:"right",open:t,onClose:n,children:Object(X.jsx)(je.a,{p:3,children:Object(X.jsx)(Ie,{})})})},ze=Object(te.a)((function(e){return{root:{display:"flex",minHeight:"100vh"},content:{flexGrow:1,overflow:"hidden",padding:e.spacing(3)}}})),Ee=function(e){var t=e.children,n=Object(V.a)(e,["children"]),r=ze();return Object(X.jsxs)(_,{children:[Object(X.jsxs)("div",{className:r.root,children:[Object(X.jsx)(ue,Object(p.a)({},n)),Object(X.jsx)("main",{className:r.content,children:t})]}),Object(X.jsx)(Ne,{})]})},Me=ke((function(){return null})),Re=n(102),Ae=n(371),He=n(372),We=n(385),Ue=n(380),De=n(373),qe=n(374),Ge={username:"",password:""},Ke=Re.a().shape({username:Re.b().required(),password:Re.b().required()}),Je=Object(te.a)((function(e){return{container:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"calc(100vh - ".concat(e.mixins.toolbar.minHeight,"px)")},avatar:{width:e.spacing(8),height:e.spacing(8),backgroundColor:e.palette.primary.main}}})),Ve=Object(s.b)((function(e){return{isLoading:ve(e),error:ye(e)}}),(function(e){return Object(p.a)({},Object(f.b)({login:B},e))})),Qe=Object(f.d)(ke,Ve)((function(e){var t=e.isLoading,n=e.error,r=e.login,a=Je(),i=Object(ne.a)(["typography","form","button"]).t;return Object(X.jsx)(Ae.a,{className:a.container,maxWidth:"xs",children:Object(X.jsx)(he.Formik,{initialValues:Ge,validationSchema:Ke,onSubmit:function(e){r(e)},children:Object(X.jsx)(Le,{children:Object(X.jsxs)(He.a,{container:!0,spacing:2,children:[Object(X.jsx)(He.a,{item:!0,xs:12,align:"middle",children:Object(X.jsx)(We.a,{className:a.avatar,children:Object(X.jsx)(De.a,{fontSize:"large"})})}),Object(X.jsx)(He.a,{item:!0,xs:12,align:"middle",children:Object(X.jsx)(ie.a,{component:"h1",variant:"h5",children:i("typography:heading.signIn")})}),n&&Object(X.jsx)(He.a,{item:!0,xs:12,children:Object(X.jsx)(Ue.a,{severity:"error",children:n})}),Object(X.jsx)(He.a,{item:!0,xs:12,children:Object(X.jsx)(Le.Input,{label:i("form:label.username"),name:"username",InputProps:{startAdornment:Object(X.jsx)(qe.a,{})}})}),Object(X.jsx)(He.a,{item:!0,xs:12,children:Object(X.jsx)(Le.Input,{type:"password",label:i("form:label.password"),name:"password",InputProps:{startAdornment:Object(X.jsx)(De.a,{})}})}),Object(X.jsx)(He.a,{item:!0,xs:12,align:"middle",children:Object(X.jsx)(Le.Submit,{disabled:t,fullWidth:!0,children:i("button:signIn")})})]})})})})})),Xe=function(e){return Object(X.jsx)(Ee,Object(p.a)(Object(p.a)({},e),{},{children:Object(X.jsxs)(J.c,{children:[Object(X.jsx)(J.a,{exact:!0,path:"/",component:Qe}),Object(X.jsx)(J.a,{path:"",component:Me})]})}))},Ye=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,388)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),i(e),c(e)}))},Ze=function(e){var t=Object(O.a)({reducer:R,middleware:[].concat(Object(b.a)(Object(O.f)({serializableCheck:{ignoredActions:[h.a,h.f,h.b,h.c,h.d,h.e]}})),[]),preloadedState:e,devTools:!1});return{store:t,persistor:Object(h.h)(t)}}({}),$e=Ze.store,_e=Ze.persistor;c.a.render(Object(X.jsx)(a.a.Suspense,{fallback:null,children:Object(X.jsx)(s.a,{store:$e,children:Object(X.jsx)(o.a,{loading:null,persistor:_e,children:Object(X.jsx)(l.a,{i18n:D,children:Object(X.jsx)(u.a,{theme:K,children:Object(X.jsxs)(j.a,{basename:"/ad",children:[Object(X.jsx)(d.a,{}),Object(X.jsx)(Xe,{})]})})})})})}),document.getElementById("root")),Ye()}},[[331,1,2]]]);
//# sourceMappingURL=main.a7916ad1.chunk.js.map